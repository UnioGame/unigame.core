# Link XML Generator for Unity

An advanced link.xml file generator for Unity projects with support for multiple resource types and automated section management.

## Overview

`LinkXmlGenerator` is a Unity Editor utility that automatically generates and updates the `link.xml` file required for proper IL2CPP builds. The generator supports various resource types and preserves existing manual rules in the file. It also includes `LinkXmlGeneratorAsset` - a ScriptableObject-based solution for easy configuration through Unity Inspector.

## Features

- ✅ **Safe Updates**: Only overwrites the automatically generated section between markers
- ✅ **Manual Rules Preservation**: Doesn't affect user rules outside the automatic section  
- ✅ **Automatic Creation**: Creates `link.xml` and `Assets` directory if they don't exist
- ✅ **Multiple Resource Types**: Support for namespaces, types, assemblies, regex patterns, and base types
- ✅ **Editor Code Exclusion**: Automatically skips types from Editor assemblies
- ✅ **Backward Compatibility**: Support for legacy API
- ✅ **ScriptableObject Asset**: Easy configuration through Unity Inspector with `LinkXmlGeneratorAsset`
- ✅ **Odin Inspector Support**: Enhanced UI when Odin Inspector is available

## Installation

1. Place `LinkXmlGenerator.cs` and `LinkXmlGeneratorAsset.cs` in an `Editor` folder of your project
2. Files will only be available in Editor mode (thanks to `#if UNITY_EDITOR`)

## Usage

### Method 1: Using LinkXmlGeneratorAsset (Recommended)

1. **Create Asset**: Right-click in Project window → Create → UniGame/Tools/Link Xml Generator Asset
2. **Configure Resources**: Add resources through the Inspector:
   - Use the "Resources" list to add different types of resources
   - Each resource can be enabled/disabled individually
   - Set the resource type (Namespace, BaseType, ConcreteType, RegexPattern, Assembly)
   - Configure the appropriate string value
3. **Generate**: Click "Generate Link Xml" button in Inspector or use context menu

#### Adding Resources in Inspector:
- **Namespace Resources**: Enter namespace name (e.g., "MyProject.Core")
- **Base Type Resources**: Enter full type name (e.g., "UnityEngine.MonoBehaviour") to include the type + all inheritors
- **Concrete Type Resources**: Enter exact type name (e.g., "MySpecificClass")
- **Regex Pattern Resources**: Enter regex pattern (e.g., ".*Controller$")
- **Assembly Resources**: Enter assembly name (e.g., "MyProject.Runtime")

### Method 2: Using Code API

```csharp
using System;
using UnityEngine;
            LinkXmlResource.FromRegex(@".*Controller$"), // all classes ending with "Controller"
            LinkXmlResource.FromRegex(@"^MyProject\.Data\..*"), // all types in MyProject.Data
            
            // Include entire assembly
            LinkXmlResource.FromAssembly("MyProject.Runtime"),
        };

        LinkXmlGenerator.GenerateFromResources(resources);
    }
}
```

## Resource Types

#### 1. Namespace
Includes all types in the specified namespace and its sub-namespaces:
```csharp
LinkXmlResource.FromNamespace("MyProject.Core")
// Will include: MyProject.Core.*, MyProject.Core.Utils.*, etc.
```

#### 2. Base Type
Includes the base type itself and all its inheritors:
```csharp
LinkXmlResource.FromBaseType(typeof(UIWindow))
LinkXmlResource.FromBaseType("MyProject.UI.UIWindow") // Using string type name
// Will include: UIWindow + all classes inheriting from UIWindow
```

#### 3. Concrete Type
Includes only the specified type:
```csharp
LinkXmlResource.FromConcreteType("MySpecificClass")
LinkXmlResource.FromConcreteType(typeof(MyClass))
```

#### 4. Regex Pattern
Includes types whose names match the regex pattern:
```csharp
LinkXmlResource.FromRegex(@".*Manager$")     // all classes ending with "Manager"
LinkXmlResource.FromRegex(@"^UI\..*")        // all types starting with "UI."
LinkXmlResource.FromRegex(@"Controller|Service|Handler") // multiple patterns
```

#### 5. Entire Assembly
Includes all types in the specified assembly:
```csharp
LinkXmlResource.FromAssembly("MyProject.Runtime")
// Creates: <assembly fullname="MyProject.Runtime" preserve="all"/>
```

## Generated link.xml Structure

```xml
<linker>
  <!-- You can keep your manual rules here -->
  
  <!-- BEGIN-AUTO-GENERATED-BY-LinkXmlNamespaceGenerator -->
  <!-- DO NOT EDIT MANUALLY: this section is regenerated by LinkXmlGenerator -->
  
  <!-- Entire assemblies -->
  <assembly fullname="MyProject.Runtime" preserve="all"/>
  
  <!-- Partial assemblies -->
  <assembly fullname="Assembly-CSharp">
    <namespace fullname="MyProject.Core" preserve="all"/>
    <namespace fullname="MyProject.Gameplay" preserve="all"/>
    <type fullname="MySpecificClass" preserve="all"/>
    <type fullname="SomeController" preserve="all"/>
  </assembly>
  
  <!-- END-AUTO-GENERATED-BY-LinkXmlNamespaceGenerator -->
  
  <!-- Your manual rules continue to work here -->
</linker>
```

## Unity Editor Menu

The generator includes an example menu in Unity Editor:

**Tools → Link XML → Generate from Resources [example]**

This example can be used as a template for creating your own configurations.

## LinkXmlGeneratorAsset Configuration

### Creating and Using the Asset
1. **Create**: Right-click in Project window → Create → UniGame/Tools/Link Xml Generator Asset
2. **Configure**: 
   - Add resources to the "Resources" list
   - Set resource type and values
   - Enable/disable individual resources
   - Use legacy "Namespaces" and "Types" arrays for backward compatibility
3. **Generate**: Click "Generate Link Xml" button or use context menu

### Inspector Helper Buttons
- **Add Namespace Resource**: Quickly add a namespace resource
- **Add Base Type Resource**: Add a base type resource with MonoBehaviour as default
- **Add Regex Resource**: Add a regex pattern resource

### Odin Inspector Integration
If Odin Inspector is available, additional buttons and enhanced UI will be displayed.

## Backward Compatibility

The old API still works but is marked as deprecated:
```csharp
[System.Obsolete("Use GenerateFromResources instead")]
public static void GenerateByNamespacesGlobalTypesAndBaseTypes(
    IEnumerable<string> namespacePrefixes,
    IEnumerable<string> globalTypeNames,
    IEnumerable<Type> baseTypes)
```

The `LinkXmlGeneratorAsset` also maintains backward compatibility with legacy `Namespaces` and `Types` arrays.

## Exclusion Logic

The generator automatically excludes:
- **Editor assemblies**: `*.Editor`, `*.EditorTests`, `UnityEditor`
- **Editor types**: Types from `UnityEditor.*` namespace
- **Generic definitions**: Open generic types (only concrete types are included)
- **Dynamic assemblies**: Assemblies created at runtime

## Error Handling

- ✅ Automatic file and directory creation
- ✅ Detailed operation logging
- ✅ Graceful handling of reflection errors
- ✅ XML structure validation
- ✅ Error recovery

## Usage Recommendations

### 1. Create a dedicated configuration class
```csharp
public static class ProjectLinkXmlConfig
{
    [MenuItem("MyProject/Generate Link XML")]
    public static void GenerateProjectLinkXml()
    {
        var resources = GetProjectResources();
        LinkXmlGenerator.GenerateFromResources(resources);
    }
    
    private static LinkXmlResource[] GetProjectResources()
    {
        return new[]
        {
            // Your project settings
        };
    }
}
```

### 2. Use in CI/CD
```csharp
// For automated builds
public static void GenerateLinkXmlForBuild()
{
    var resources = new[] { /* ... */ };
    LinkXmlGenerator.GenerateFromResources(resources);
}
```

### 3. Combine different resource types
```csharp
var resources = new[]
{
    // Core systems via namespace
    LinkXmlResource.FromNamespace("MyProject.Core"),
    
    // Specific types
    LinkXmlResource.FromConcreteType("ImportantSingleton"),
    
    // Architectural patterns via regex
    LinkXmlResource.FromRegex(@".*Controller$"),
    LinkXmlResource.FromRegex(@".*Service$"),
    
    // External libraries entirely
    LinkXmlResource.FromAssembly("ThirdParty.Library"),
};
```

### 4. Use ScriptableObject Assets for team collaboration
Create `LinkXmlGeneratorAsset` files for different configurations:
- `CoreSystemsLinkXml.asset` - Core game systems
- `UISystemsLinkXml.asset` - UI-related types
- `NetworkingLinkXml.asset` - Network serialization types

## Debugging

All operations are logged to Unity Console:
- `[LinkXmlGenerator] Created directory: ...`
- `[LinkXmlGenerator] Created new link.xml file at: ...`
- `[LinkXmlGenerator] link.xml updated successfully at: ...`
- `[LinkXmlGenerator] No resources provided for generation.`
- `[LinkXmlGenerator] Failed to update link.xml: ...`

Asset-specific logs:
- `[AssetName] No resources configured for link.xml generation.`
- `[AssetName] Generating link.xml with X resources...`

## File Locations

- **Generator**: `Assets/Editor/LinkXmlGenerator.cs` (or any Editor folder)
- **Asset Script**: `Assets/Editor/LinkXmlGeneratorAsset.cs` (or any Editor folder)
- **Configuration Assets**: Anywhere in the project (recommended: `Assets/Settings/LinkXml/`)
- **Result**: `Assets/link.xml` (Unity's standard location)

## Best Practices

1. **Use ScriptableObject assets** for team configurations
2. **Organize by domain** - create separate assets for different systems
3. **Version control** your `LinkXmlGeneratorAsset` files
4. **Test before builds** - run generation and verify the resulting `link.xml`
5. **Document your regex patterns** - use clear, commented expressions
6. **Prefer specific over broad** - use concrete types over wide namespace includes when possible

---

## License

Use freely in your Unity projects.